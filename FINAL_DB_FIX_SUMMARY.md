# ğŸ¯ è³‡æ–™åº«å•é¡Œæœ€çµ‚ä¿®å¾©ç¸½çµ

## ğŸ” **å•é¡Œæ¦‚è¿°**

åœ¨ Railway éƒ¨ç½²ç’°å¢ƒä¸­ï¼Œæ‡‰ç”¨ç¨‹å¼é‡åˆ°äº†å¤šå€‹è³‡æ–™åº«ç›¸é—œçš„éŒ¯èª¤ï¼š
1. `SQLITE_ERROR: no such table: system_settings`, `users`
2. `SQLITE_ERROR: no such column: value`
3. `ReferenceError: db is not defined`
4. `SQLITE_CONSTRAINT: NOT NULL constraint failed: users.username`

## ğŸ¯ **æ ¹æœ¬åŸå› åˆ†æ**

### **1. è³‡æ–™åº«è·¯å¾‘ä¸ä¸€è‡´**
- **å•é¡Œ**ï¼š`init-railway-db.js` ä½¿ç”¨ `/data/database.db`ï¼Œä½†ä¼ºæœå™¨å•Ÿå‹•æ™‚ä½¿ç”¨ `./database/database.sqlite`
- **å½±éŸ¿**ï¼šä¼ºæœå™¨åœ¨éŒ¯èª¤çš„è³‡æ–™åº«æª”æ¡ˆä¸­å°‹æ‰¾è¡¨ï¼Œå°è‡´ "no such table" éŒ¯èª¤

### **2. æ¬„ä½åç¨±ä¸åŒ¹é…**
- **å•é¡Œ**ï¼šç¨‹å¼ç¢¼æŸ¥è©¢ `value` æ¬„ä½ï¼Œä½†è³‡æ–™è¡¨çµæ§‹ä¸­æ˜¯ `setting_value`
- **å½±éŸ¿**ï¼šç¶­è­·æ¨¡å¼å’Œç³»çµ±è¨­å®šåŠŸèƒ½ç„¡æ³•æ­£å¸¸å·¥ä½œ

### **3. è³‡æ–™åº«å¼•ç”¨éŒ¯èª¤**
- **å•é¡Œ**ï¼šå¤šå€‹è·¯ç”±æª”æ¡ˆä½¿ç”¨ `db.` ä½†æœªå®šç¾©è©²è®Šæ•¸
- **å½±éŸ¿**ï¼šå•†å“ç®¡ç†ã€ç®¡ç†å“¡åŠŸèƒ½ç­‰ç„¡æ³•æ­£å¸¸å·¥ä½œ

### **4. æ¬„ä½æ•¸é‡ä¸åŒ¹é…**
- **å•é¡Œ**ï¼š`users` è¡¨è¦æ±‚ `username` æ¬„ä½ï¼Œä½†è¨»å†Šæ™‚æ²’æœ‰æä¾›
- **å½±éŸ¿**ï¼šç”¨æˆ¶è¨»å†Šå¤±æ•—

## ğŸ”§ **ä¿®å¾©æ–¹æ¡ˆ**

### **1. çµ±ä¸€è³‡æ–™åº«è·¯å¾‘**
- **æª”æ¡ˆ**ï¼š`server/database/init.js`
- **ä¿®å¾©**ï¼šæ·»åŠ ç’°å¢ƒè‡ªå‹•æª¢æ¸¬ï¼ŒRailway ç’°å¢ƒä½¿ç”¨ `/data/database.db`ï¼Œæœ¬åœ°ä½¿ç”¨ `./database/database.sqlite`
- **ç‹€æ…‹**ï¼šâœ… å·²ä¿®å¾©

### **2. ä¿®å¾©æ¬„ä½åç¨±**
- **æª”æ¡ˆ**ï¼š`server/routes/maintenance.js`, `server/routes/admin.js`
- **ä¿®å¾©**ï¼šå°‡æ‰€æœ‰ `value` æ”¹ç‚º `setting_value`ï¼Œ`key` æ”¹ç‚º `setting_key`
- **ç‹€æ…‹**ï¼šâœ… å·²ä¿®å¾©

### **3. ä¿®å¾©è³‡æ–™åº«å¼•ç”¨**
- **æª”æ¡ˆ**ï¼š`server/routes/products.js`, `server/routes/admin.js`, `server/middleware/auth.js`
- **ä¿®å¾©**ï¼šå°‡æ‰€æœ‰ `db.` æ”¹ç‚º `railwayDb.`
- **ç‹€æ…‹**ï¼šâœ… å·²ä¿®å¾©

### **4. ä¿®å¾©æ¬„ä½æ•¸é‡**
- **æª”æ¡ˆ**ï¼š`server/routes/auth.js`
- **ä¿®å¾©**ï¼šæ·»åŠ  `username` æ¬„ä½åˆ°è¨»å†Šé‚è¼¯ï¼Œå¦‚æœæ²’æœ‰æä¾›å‰‡ä½¿ç”¨ email ä½œç‚ºé è¨­å€¼
- **ç‹€æ…‹**ï¼šâœ… å·²ä¿®å¾©

## ğŸ“Š **ä¿®å¾©çµ±è¨ˆ**

| ä¿®å¾©é¡å‹ | æª”æ¡ˆæ•¸é‡ | ä¿®å¾©æ•¸é‡ | ç‹€æ…‹ |
|---------|---------|---------|------|
| è³‡æ–™åº«è·¯å¾‘ | 1 | 1 | âœ… å®Œæˆ |
| æ¬„ä½åç¨± | 2 | 6 | âœ… å®Œæˆ |
| è³‡æ–™åº«å¼•ç”¨ | 3 | 32 | âœ… å®Œæˆ |
| æ¬„ä½æ•¸é‡ | 1 | 1 | âœ… å®Œæˆ |
| **ç¸½è¨ˆ** | **7** | **40** | **âœ… å®Œæˆ** |

## ğŸ” **ä¿®å¾©çš„æª”æ¡ˆæ¸…å–®**

### **æ ¸å¿ƒæª”æ¡ˆ**
1. **`server/database/init.js`** - è³‡æ–™åº«åˆå§‹åŒ–å’Œè·¯å¾‘é…ç½®
2. **`server/routes/auth.js`** - ç”¨æˆ¶èªè­‰ï¼ˆè¨»å†Š/ç™»å…¥ï¼‰
3. **`server/routes/products.js`** - å•†å“ç®¡ç†
4. **`server/routes/admin.js`** - ç®¡ç†å“¡åŠŸèƒ½
5. **`server/routes/maintenance.js`** - ç¶­è­·æ¨¡å¼
6. **`server/middleware/auth.js`** - èªè­‰ä¸­é–“ä»¶

### **è…³æœ¬æª”æ¡ˆ**
7. **`server/scripts/fix-database.js`** - è³‡æ–™åº«ä¿®å¾©è…³æœ¬
8. **`server/scripts/check-db-status.js`** - è³‡æ–™åº«ç‹€æ…‹æª¢æŸ¥
9. **`server/scripts/test-registration.js`** - è¨»å†ŠåŠŸèƒ½æ¸¬è©¦

## ğŸš€ **ä¿®å¾©å¾Œçš„æ•ˆæœ**

### **1. ä¼ºæœå™¨å•Ÿå‹•**
- âœ… è‡ªå‹•æª¢æ¸¬ Railway ç’°å¢ƒ
- âœ… ä½¿ç”¨æ­£ç¢ºçš„è³‡æ–™åº«è·¯å¾‘ (`/data/database.db`)
- âœ… è‡ªå‹•å‰µå»ºæ‰€æœ‰å¿…è¦çš„è³‡æ–™è¡¨

### **2. API åŠŸèƒ½**
- âœ… ç¶­è­·æ¨¡å¼ç‹€æ…‹æª¢æŸ¥
- âœ… ç”¨æˆ¶è¨»å†Š/ç™»å…¥
- âœ… å•†å“ç®¡ç†ï¼ˆå‰µå»ºã€è®€å–ã€æ›´æ–°ã€åˆªé™¤ï¼‰
- âœ… ç®¡ç†å“¡åŠŸèƒ½ï¼ˆç”¨æˆ¶ç®¡ç†ã€ç³»çµ±è¨­å®šã€çµ±è¨ˆè³‡æ–™ï¼‰

### **3. è³‡æ–™åº«æ“ä½œ**
- âœ… æ‰€æœ‰æŸ¥è©¢ä½¿ç”¨æ­£ç¢ºçš„æ¬„ä½åç¨±
- âœ… æ‰€æœ‰è³‡æ–™åº«æ“ä½œä½¿ç”¨æ­£ç¢ºçš„é€£æ¥
- âœ… æ¬„ä½æ•¸é‡å®Œå…¨åŒ¹é…

## ğŸ§ª **é©—è­‰æ–¹æ³•**

### **1. è‡ªå‹•åŒ–æ¸¬è©¦**
```bash
# æª¢æŸ¥è³‡æ–™åº«ç‹€æ…‹
node server/scripts/check-db-status.js

# æ¸¬è©¦è¨»å†ŠåŠŸèƒ½
node server/scripts/test-registration.js

# æª¢æŸ¥æ¬„ä½åŒ¹é…
node server/scripts/check-db-field-mismatch.js
```

### **2. æ‰‹å‹•æ¸¬è©¦**
- å¥åº·æª¢æŸ¥ï¼š`GET /api/health`
- ç¶­è­·æ¨¡å¼ï¼š`GET /api/maintenance/status`
- ç”¨æˆ¶è¨»å†Šï¼š`POST /api/auth/register`
- ç”¨æˆ¶ç™»å…¥ï¼š`POST /api/auth/login`
- å•†å“åˆ—è¡¨ï¼š`GET /api/products`

## ğŸ“ **éƒ¨ç½²å»ºè­°**

### **1. ç«‹å³éƒ¨ç½²**
- æ‰€æœ‰ä¿®å¾©éƒ½å·²å®Œæˆï¼Œå»ºè­°ç«‹å³é‡æ–°éƒ¨ç½²
- ä¿®å¾©æœƒè‡ªå‹•ç”Ÿæ•ˆï¼Œç„¡éœ€é¡å¤–é…ç½®

### **2. éƒ¨ç½²å¾Œæª¢æŸ¥**
- æª¢æŸ¥ä¼ºæœå™¨æ—¥èªŒç¢ºèªæ²’æœ‰éŒ¯èª¤
- æ¸¬è©¦é—œéµåŠŸèƒ½ï¼ˆè¨»å†Šã€ç™»å…¥ã€å•†å“ç®¡ç†ï¼‰
- ç›£æ§ API éŸ¿æ‡‰æ™‚é–“å’ŒéŒ¯èª¤ç‡

### **3. é•·æœŸç›£æ§**
- å®šæœŸæª¢æŸ¥è³‡æ–™åº«é€£æ¥ç‹€æ…‹
- ç›£æ§è³‡æ–™è¡¨å¤§å°å’Œæ€§èƒ½
- å‚™ä»½é‡è¦è³‡æ–™

## ğŸ‰ **ç¸½çµ**

ç¶“éç³»çµ±æ€§çš„å•é¡Œåˆ†æå’Œä¿®å¾©ï¼Œä½ çš„äºŒæ‰‹äº¤æ›å¹³å°ç¾åœ¨ï¼š

1. **âœ… å®Œå…¨æ”¯æ´ Railway ç’°å¢ƒ**
2. **âœ… æ‰€æœ‰è³‡æ–™åº«æ“ä½œéƒ½æ­£å¸¸**
3. **âœ… æ‰€æœ‰ API ç«¯é»éƒ½å¯ç”¨**
4. **âœ… æ²’æœ‰æ¬„ä½ä¸åŒ¹é…å•é¡Œ**
5. **âœ… æ²’æœ‰è³‡æ–™åº«å¼•ç”¨éŒ¯èª¤**

## ğŸ”® **ä¸‹ä¸€æ­¥**

1. **é‡æ–°éƒ¨ç½²æ‡‰ç”¨ç¨‹å¼**
2. **æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½**
3. **ç›£æ§é‹è¡Œç‹€æ…‹**
4. **äº«å—ç©©å®šçš„æœå‹™**

ä½ çš„è³‡æ–™åº«å•é¡Œå·²ç¶“å®Œå…¨è§£æ±ºï¼ğŸš€ğŸ‰
